<!DOCTYPE html>

<html>
<head>
  <title>Sanitation of Vulnerable Data</title>
  <link href="search/tipuesearch.css" rel="stylesheet">
  <link href="style.css" rel="stylesheet">
</head>

<body class="page--sanitation">
<header>
  <div class="pager"><a href="remote.html" class="prev remote">&laquo;Remote Environment</a><a href="index.html" class="index pager__book-title">Live Dev Porter: Documentation</a><a href="source-control.html" class="next source-control">Source Control&raquo;</a></div></header>
<section class="sub-header">
  <div class="breadcrumbs"><a href="index.html">Index</a>
         &raquo
      </div>      <div class="search__wrapper">
  <form action="search--results.html">
    <input type="text" class="search-input" name="q" id="tipue_search_input" autocomplete="off" required>
  </form>
</div>
  </section>

<section>
  <h1>Sanitation of Vulnerable Data</h1>
  

<p>This example shows how to setup a processor that will remove the password and secrets from a non-versioned <em>.env</em> file on <code>pull</code>.</p>

<ol>
<li>Define a file group <code>install</code>, which includes a file called <em>.env</em>.</li>
<li>Next, map the file group to your local, e.g., <code>environments.0.files.install</code></li>
<li><em>(You will need to also map it to the remote, but that's covered elsewhere.)</em></li>
<li>Define a workflow: <code>development</code></li>
<li>Add to that workflow a processor item pointing to a class::method, in this case <code>RemoveSecrets::process</code></li>
<li>Configured the environment to use the <code>development</code> workflow by default on <code>pull</code></li>
<li>Create the processor class::method as <em>./live_dev_porter/processors/RemoveSecrets.php</em>. Notice the trait and the parent class and study those for more info.</li>
</ol>

<h2>Configuration</h2>

<blockquote>
  <p>This is not a complete configuration, for example the remove environment is missing; just the items needed to illustrate this concept are shown.</p>
</blockquote>

<p><em>.live_dev_porter/config.yml</em></p>

<pre><code class="yaml">file_groups:
  install:
    include:
      - /.env

workflows:
  development:
    -
      processor: RemoveSecrets::process

environments:
  local:
    files:
      install: install/default/scaffold
    command_workflows:
      pull: development
</code></pre>

<h2>The Processor File</h2>

<p><em>./live_dev_porter/processors/RemoveSecrets.php</em></p>

<pre><code class="php">&lt;?php

use AKlump\LiveDevPorter\Processors\ProcessorFailedException;

class RemoveSecrets extends \AKlump\LiveDevPorter\Processors\ProcessorBase {

  use \AKlump\LiveDevPorter\Processors\EnvTrait;

  public function process() {
    if (!$this-&gt;loadFile()
      || basename($this-&gt;filepath) != '.env') {
      return;
    }

    $response = [];
    $this-&gt;envReplaceUrlPassword('DATABASE_URL');
    $response[] = "DATABASE_URL password";
    foreach (['HASH_SALT', 'SHAREFILE_CLIENT_SECRET'] as $variable_name) {
      $this-&gt;envReplaceValue($variable_name);
      $response[] = $variable_name;
    }
    $this-&gt;saveFile();

    return sprintf("Removed %s from %s.", implode(', ', $response), $this-&gt;shortpath);
  }

}
</code></pre>

</section>

<div class="search__results">
  <div id="tipue_search_content"></div>
</div>

<footer>
  <div class="pager"><a href="remote.html" class="prev remote">&laquo;Remote Environment</a><a href="index.html" class="index pager__book-title">Live Dev Porter: Documentation</a><a href="source-control.html" class="next source-control">Source Control&raquo;</a></div>  
  <div id="footer-legaleeze">
    <p class="legaleeze center">Version: 0.0.99 &bull; Last Updated: Thu, 27 Oct 2022 21:39:50 -0700</p>
  </div>
</footer>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
  <script src="search/tipuesearch_content.js"></script>
  <script src="search/tipuesearch_set.js"></script>
  <script src="search/tipuesearch.min.js"></script>
  <script>
    $(document).ready(function() {
      $('#tipue_search_input').tipuesearch()
    })
  </script>
<script src="js/core.js"></script>
</body>
</html>
